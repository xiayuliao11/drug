<!DOCTYPE html>
<html lang="en">
<!-- 引入jquery -->
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<!-- 引入bootstrap的css、js -->
	<link rel="stylesheet" href="bootstrap3/css/bootstrap.css">
	<script type="text/javascript"src="bootstrap3/js/bootstrap.js"></script>
		<!-- bootstraptable的js,css -->
    <link rel="stylesheet" href="js/bootstrap-table/bootstrap-table.min.css">
    <script src="js/bootstrap-table/bootstrap-table.min.js"></script>
    <script src="js/bootstrap-bootbox/bootbox.js"></script>
    <script src="js/bootstrap-table/locale/bootstrap-table-zh-CN.min.js"></script>
<head>
    <meta charset="UTF-8">
    <title>发票列表！</title>
</head>
   <table id="table" class="table"></table>
</body>
<script>
//查询列表
   $("#table").bootstrapTable({
       url:"http://192.168.101.37:1999/findInvoice",
       queryParams:function(){
           return {};
       },
       columns:[
           {field:"invoiceType",title:"发票类型"},
           {field:"invoiceHao",title:"订单号"},
           {field:"lowerTime",title:"下单时间"},
           {field:"address",title:"采购企业"},
           {field:"invoiceName",title:"采购人姓名"},
           {field:"status",title:"发票状态",formatter:function(value,row,index){
            return   value==0?'待开票':'已开票';
           }},
           {field:"invoiceText",title:"发票内容"},
           {field:"invoiceMoney",title:"发票金额",formatter:function(value,row,index){
                   return "<font color='red'>"+value+"</font>";
           }},
           {field:"status",title:"操作",formatter:function(value,row,index){
                   return  value==0?"<button type='button' class='btn btn-default' onclick='Kai(\""+row.id+"\")'>开票</button>":"<button type='button' class='btn btn-default' onclick='hxInvoice(\""+row.id+"\")'>查看</button>";
               }}
       ]
   })
//开票
function  Kai(id){
   $.ajax({
      url:'http://192.168.101.37:1999/updateInvoice',
       type:"post",
      data:{id:id},
      dataType:'json',
      success:function(data){
          $('#table').bootstrapTable('refresh');
      }
   })
}
var res;
function createAddContent(url){
    $.ajax({
        url:url,
        async:false,
        success:function(data){
            res = data;
        }
    });
    return res;
}
//修改回显
function hxInvoice(id) {
    bootbox.dialog({
        title: '发票信息',
        message: createAddContent("toInvoice"),
        closeButton: true,
        buttons: {
            "success": {
                "label": "<i class='glyphicon glyphicon-ok'></i> 确定",
                "className": "btn-sm btn-success",
                "callback": function () {
                }
            },
        }
    });
    $.ajax({
        url: "invoiceById",
        data: {id: id},
        async: false,
        success: function (data) {
            $("#id").val(data.id);
            $("#invoiceType").val(data.invoiceType);
            $("#address").val(data.address);
            $("#invoiceName").val(data.invoiceName);
            $("#invoiceText").val(data.invoiceText);
            $("#invoiceMoney").val(data.invoiceMoney)
        }
    })
}
</script>
</html>